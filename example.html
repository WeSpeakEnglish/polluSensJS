<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>polluSensSerial Example</title>
</head>
<body>
  <h1>polluSensSerial Test</h1>

  <button id="connectBtn">🔌 Connect</button>
  <pre id="log">Waiting for sensor data...</pre>

  <script type="module">
    import { PolluSensSerial } from './polluSensSerial.js';

    const log = document.getElementById('log');
    const connectBtn = document.getElementById('connectBtn');

    let sensor;

    connectBtn.onclick = async () => {
      if (sensor) {
        await sensor.disconnect();
        sensor = null;
        connectBtn.textContent = '🔌 Connect';
        log.textContent += '\n🔌 Disconnected.\n';
        return;
      }

      try {
        // Load default config and select by name
        const [sensorConfig] = await PolluSensSerial.loadConfig('https://raw.githubusercontent.com/WeSpeakEnglish/polluSensWeb/refs/heads/main/sensors.json', 'Panasonic SN-GCJA5');
        sensor = new PolluSensSerial(sensorConfig);

        sensor.onData = data => {
          log.textContent += `📈 ${JSON.stringify(data)}\n`;
        };

        sensor.onError = msg => {
          log.textContent += `❌ ${msg}\n`;
        };

        await sensor.connect();
        connectBtn.textContent = '❌ Disconnect';
        log.textContent += '✅ Connected.\n';

      } catch (e) {
        log.textContent += `❌ Error: ${e.message}\n`;
      }
    };
  </script>
</body>
</html>
